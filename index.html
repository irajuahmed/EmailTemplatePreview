<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Email Preview Modal</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<style>
    /* Modal customization */
    #emailPreviewModal .modal-content {
        border-radius: 10px;
        border: 1px solid #ccc;
    }

    #emailPreviewModal .modal-body {
        background-color: #fefefe;
        font-family: 'Segoe UI', Tahoma, sans-serif;
        color: #333;
    }

    #previewTemplatesContainer {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
    }

    .email-template {
        flex: 1 1 45%;
        border: 1px solid #ccc;
        border-radius: 8px;
        padding: 15px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        min-width: 300px;
    }

    /* Fullscreen modal */
    .fullscreen-modal {
        width: 100% !important;
        max-width: 100% !important;
        height: 95vh;
        margin: 0;
    }

    .fullscreen-modal .modal-content {
        height: 100%;
    }

    .fullscreen-modal .modal-body {
        overflow-y: auto;
        height: calc(100% - 60px);
    }

    /* Minimized bar */
    #minimizedBar {
        width: 250px;
        text-align: center;
        font-weight: 500;
        cursor: pointer;
        position: fixed;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 1055;
        display: none;
        background-color: #0d6efd;
        color: #fff;
        padding: 5px 10px;
        border-radius: 5px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    /* Header buttons */
    .modal-header .btn-outline-secondary {
        border-color: #c4e4e9;
        color: #c4e4e9;
    }

    .modal-header .btn-outline-secondary:hover {
        background-color: #c4e4e9;
        color: #000;
    }
</style>
</head>
<body>
<div class="container mt-5">

    <h3>Email Preview Example</h3>

    <!-- Input fields -->
    <div class="mb-3">
        <label>Subject</label>
        <input type="text" id="emailsubject" class="form-control" value="Test Email Subject">
        <span data-valmsg-for="emailsubject" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label>Recipients (comma-separated)</label>
        <input type="text" id="emailrecipients" class="form-control" value="dummyuser1@domain.com,dummyuser2@domain.com">
        <span data-valmsg-for="emailrecipients" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label>Arabic Body</label>
        <textarea id="messagebodyemailar" class="form-control" rows="3">Ù…Ø±Ø­Ø¨Ø§ØŒ Ù‡Ø°Ø§ Ù†Øµ ØªØ¬Ø±ÙŠØ¨ÙŠ.</textarea>
        <span data-valmsg-for="messagebodyemailar" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label>English Body</label>
        <textarea id="messagebodyemail" class="form-control" rows="3">Hello, this is a sample text.</textarea>
    </div>

    <button id="btnPreviewEmail" class="btn btn-primary">Preview Email</button>

</div>

<!-- Modal -->
<div class="modal fade" id="emailPreviewModal" tabindex="-1" aria-labelledby="emailPreviewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header position-relative">
                <div class="flex-grow-1 text-start">
                    <p class="modal-title fw-semibold m-0" id="emailPreviewModalLabel">Email Preview</p>
                </div>

                <!-- Expand / Fullscreen Button -->
                <button type="button" id="btnExpandModal" class="btn btn-sm btn-outline-secondary ms-auto me-2">â›¶</button>

                <!-- Minimize Button -->
                <button type="button" id="btnMinimizeModal" class="btn btn-sm btn-outline-secondary ms-auto me-2">ðŸ—•</button>

                <!-- Close Button -->
                <button type="button" id="btnCloseModal" class="btn btn-sm btn-outline-secondary" data-bs-dismiss="modal" aria-label="Close">âœ–</button>
            </div>

            <div class="modal-body">
                <div id="previewTemplatesContainer"></div>
            </div>
        </div>
    </div>
</div>

<!-- Minimized bar -->
<div id="minimizedBar">
    Email Preview ðŸ—•
</div>

<script>
let modalState = "normal"; // normal | fullscreen | minimized

// Expand / Fullscreen toggle
$("#btnExpandModal").on("click", function () {
    if(modalState === "normal") {
        $("#emailPreviewModal .modal-dialog").addClass("fullscreen-modal");
        $(this).text("ðŸ——");
        modalState = "fullscreen";
    } else if(modalState === "fullscreen") {
        $("#emailPreviewModal .modal-dialog").removeClass("fullscreen-modal");
        $(this).text("â›¶");
        modalState = "normal";
    }
});

// Minimize modal
$("#btnMinimizeModal").on("click", function () {
    $("#emailPreviewModal").modal("hide");
    $("#minimizedBar").show();
    modalState = "minimized";
});

// Restore modal from minimized bar
$("#minimizedBar").on("click", function () {
    $("#emailPreviewModal").modal("show");
    $(this).hide();
    modalState = "normal";
});

// Preview Email logic
$("#btnPreviewEmail").on("click", function () {
    var subject = $("#emailsubject").val().trim();
    var recipients = $("#emailrecipients").val().trim();
    var date = new Date().toLocaleString() + " (Dummy)";
    var bodyAr = $("#messagebodyemailar").val().trim();
    var bodyEn = $("#messagebodyemail").val().trim();

    const emailRegex = /^[^\\s@@]+@@[^\\s@@]+\\.[^\\s@@]+$/;

    if (!subject) {
        $('span[data-valmsg-for="emailsubject"]').text("This field is required.");
        return;
    } else {
        $('span[data-valmsg-for="emailsubject"]').text("");
    }

    if (!bodyAr) {
        $('span[data-valmsg-for="messagebodyemailar"]').text("This field is required.");
        return;
    } else {
        $('span[data-valmsg-for="messagebodyemailar"]').text("");
    }

    // Validate recipients
    var emails = recipients.split(/[,;]+/).map(e => e.trim()).filter(Boolean);
    var invalidEmails = emails.filter(e => !emailRegex.test(e));
    
    $("#previewTemplatesContainer").empty();

    function buildEmailTemplate(langTitle, subjectText, bodyText) {
        return `
            <div class="email-template">
                <h5 class="fw-bold mb-3">${subjectText || "(No Subject)"}</h5>
                <div class="border-bottom pb-2 mb-3" style="font-size:14px;">
                    <div class="fw-semibold">KAF Notification System</div>
                    <div>${date}</div>
                    <div><strong>To:</strong> ${recipients}</div>
                </div>
                <div style="font-size:15px; line-height:1.6;">
                    ${bodyText || "<i>(No message content)</i>"}
                    <br><br>
                    <p>
                        Regards,<br>
                        Notification System<br>
                        IT Department<br>
                        XYZ Company<br>
                    </p>
                </div>
            </div>`;
    }

    var html = "";
    html += buildEmailTemplate("Arabic", subject, bodyAr);
    if (bodyEn) html += buildEmailTemplate("English", subject, bodyEn);

    $("#previewTemplatesContainer").html(html);

    $("#emailPreviewModal").modal("show");
});
</script>
</body>
</html>
